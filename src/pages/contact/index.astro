---
import PageLayout from '../../layouts/BaseLayout.astro'
import Section from '../../components/Section.astro'
---

<PageLayout meta={{ title: 'Contact' }}>
	<div class='flex w-full flex-col gap-y-10'>
		<section class='flex flex-col items-center gap-y-7'>
			<div class='flex flex-col items-center gap-y-4'>
				<h1 class='text-3xl font-bold'>Get in Touch</h1>
				<p class='text-center text-muted-foreground max-w-2xl'>
					Interested in working together or discussing a project? Fill out the form below and I'll
					get back to you as soon as possible.
				</p>
			</div>
		</section>

		<Section title='Contact Form'>
			<form id='contact-form' class='mx-auto w-full max-w-2xl space-y-6'>
				<div class='space-y-2'>
					<label for='name' class='block text-sm font-medium'>Name *</label>
					<input
						type='text'
						id='name'
						name='name'
						required
						class='w-full rounded-md border border-border bg-background px-4 py-2.5 text-foreground transition-colors focus:border-foreground focus:outline-none focus:ring-2 focus:ring-foreground/20'
						placeholder='Your name'
					/>
				</div>

				<div class='space-y-2'>
					<label for='email' class='block text-sm font-medium'>Email *</label>
					<input
						type='email'
						id='email'
						name='email'
						required
						class='w-full rounded-md border border-border bg-background px-4 py-2.5 text-foreground transition-colors focus:border-foreground focus:outline-none focus:ring-2 focus:ring-foreground/20'
						placeholder='your.email@example.com'
					/>
				</div>

				<div class='space-y-2'>
					<label for='company' class='block text-sm font-medium'>Company</label>
					<input
						type='text'
						id='company'
						name='company'
						class='w-full rounded-md border border-border bg-background px-4 py-2.5 text-foreground transition-colors focus:border-foreground focus:outline-none focus:ring-2 focus:ring-foreground/20'
						placeholder='Your company (optional)'
					/>
				</div>

				<div class='space-y-2'>
					<label for='subject' class='block text-sm font-medium'>Subject *</label>
					<input
						type='text'
						id='subject'
						name='subject'
						required
						class='w-full rounded-md border border-border bg-background px-4 py-2.5 text-foreground transition-colors focus:border-foreground focus:outline-none focus:ring-2 focus:ring-foreground/20'
						placeholder='What is this about?'
					/>
				</div>

				<div class='space-y-2'>
					<label for='message' class='block text-sm font-medium'>Message *</label>
					<textarea
						id='message'
						name='message'
						required
						rows='6'
						class='w-full rounded-md border border-border bg-background px-4 py-2.5 text-foreground transition-colors focus:border-foreground focus:outline-none focus:ring-2 focus:ring-foreground/20'
						placeholder='Tell me about your project or inquiry...'></textarea>
				</div>

				<div class='flex flex-col gap-3'>
					<button
						type='submit'
						class='w-full rounded-md bg-foreground px-6 py-3 font-medium text-background transition-all hover:opacity-90 disabled:cursor-not-allowed disabled:opacity-50'
					>
						Send Message
					</button>
					<div
						id='form-message'
						class='hidden rounded-md p-3 text-center text-sm font-medium'
						role='alert'
					>
					</div>
				</div>
			</form>
		</Section>
	</div>
</PageLayout>

<script>
	const form = document.getElementById('contact-form') as HTMLFormElement
	const messageDiv = document.getElementById('form-message') as HTMLDivElement
	const submitButton = form?.querySelector('button[type="submit"]') as HTMLButtonElement

	form?.addEventListener('submit', async (e) => {
		e.preventDefault()

		if (!form) return

		// Disable submit button and show loading state
		submitButton.disabled = true
		submitButton.textContent = 'Sending...'
		messageDiv.classList.add('hidden')

		const formData = new FormData(form)
		const data = {
			name: formData.get('name'),
			email: formData.get('email'),
			company: formData.get('company'),
			subject: formData.get('subject'),
			message: formData.get('message')
		}

		try {
			const response = await fetch('/api/contact', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify(data)
			})

			const result = await response.json()

			if (response.ok) {
				// Success
				messageDiv.textContent = result.message || 'Message sent successfully! I\'ll get back to you soon.'
				messageDiv.classList.remove('hidden', 'bg-red-500/10', 'text-red-500')
				messageDiv.classList.add('bg-green-500/10', 'text-green-600')
				form.reset()
			} else {
				// Error
				messageDiv.textContent =
					result.error || 'Failed to send message. Please try again or email me directly.'
				messageDiv.classList.remove('hidden', 'bg-green-500/10', 'text-green-600')
				messageDiv.classList.add('bg-red-500/10', 'text-red-500')
			}
		} catch (error) {
			console.error('Error:', error)
			messageDiv.textContent =
				'An unexpected error occurred. Please try again or email me directly at marko.jp.17@gmail.com'
			messageDiv.classList.remove('hidden', 'bg-green-500/10', 'text-green-600')
			messageDiv.classList.add('bg-red-500/10', 'text-red-500')
		} finally {
			// Re-enable submit button
			submitButton.disabled = false
			submitButton.textContent = 'Send Message'
		}
	})
</script>

